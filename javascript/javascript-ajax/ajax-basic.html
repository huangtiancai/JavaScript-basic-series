
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）</title>
	</head>
	<body>

		<div id="myDiv">
			Let AJAX change this text
		</div>
		<button type="button" onclick="loadXMLDoc()">请求数据</button>

		<script>
			//AJAX 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术。

			//1.什么是 AJAX ？
			//AJAX = 异步 JavaScript 和 XML。
			//AJAX 是一种用于创建快速动态网页的技术
			//通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。
			//有很多使用 AJAX 的应用程序案例：新浪微博、Google 地图、开心网等等

			

			//2.AJAX - 创建 XMLHttpRequest 对象

			//2.1XMLHttpRequest 对象
			//所有现代浏览器均支持 XMLHttpRequest 对象（IE5 和 IE6 使用 ActiveXObject）。
			//XMLHttpRequest 用于在后台与服务器交换数据。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。

			//2.2创建 XMLHttpRequest 对象
			//所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。
			//创建 XMLHttpRequest 对象的语法：
			variable = new XMLHttpRequest();
			//老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：
			//variable = new ActiveXObject("Microsoft.XMLHTTP");
			//为了应对所有的现代浏览器，包括 IE5 和 IE6，请检查浏览器是否支持 XMLHttpRequest 对象。如果支持，则创建 XMLHttpRequest 对象。如果不支持，则创建 ActiveXObject ：
			//在代码中检查
			var xmlhttp;
			//alert(window.XMLHttpRequest);
			if(window.XMLHttpRequest){
				// code for IE7+, Firefox, Chrome, Opera, Safari
				xmlhttp = new XMLHttpRequest();
			}else{
				// code for IE6, IE5
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}

			//3.AJAX - 向服务器发送请求
			//XMLHttpRequest 对象用于和服务器交换数据。
			//如需将请求发送到服务器，我们使用 XMLHttpRequest 对象的 open() 和 send() 方法：
			
			//open(method,url,async) 规定请求的类型、URL 以及是否异步处理请求。
			// method：请求的类型；GET 或 POST
			// url：文件在服务器上的位置
			// async：true（异步）或 false（同步）

			//send(string) 将请求发送到服务器
			//string：仅用于 POST 请求

			//GET 还是 POST？
			//与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。
			//然而，在以下情况中，请使用 POST 请求：
			// 无法使用缓存文件（更新服务器上的文件或数据库）
			// 向服务器发送大量数据（POST 没有数据量限制）
			// 发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠

			//GET 请求
			//示例：
			function loadXMLDoc(){
				alert("ajax");
				var xmlhttp;
				if(window.XMLHttpRequest){
					xmlhttp = new XMLHttpRequest();
				}else{
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
				}
				//var requestURL = 'https://mdn.github.io/learning-area/javascript/oojs/json/superheroes.json';
				xmlhttp.open('GET','/ajax/demo_get.txt',true);
				xmlhttp.send();

				xmlhttp.onreadystatechange = function(){
					alert("onreadystatechange");
					if(xmlhttp.readyState==4 && xmlhttp.status==200){
						document.getElementById('myDiv').innerHTML = xmlhttp.responseText;
					}
				}
			}

			//浏览器会报错:
			//Access to XMLHttpRequest at 'file:///E:/ajax/demo_get.txt' from origin 'null' has been blocked by CORS policy:
			//Cross origin requests are only supported for protocol schemes: http, data, chrome, chrome-extension, https.
			
			//原因很简单，浏览器（Webkit内核）的安全策略决定了file协议访问的应用无法使用XMLHttpRequest对象
			//跨域请求仅支持协议：http, data, chrome, chrome-extension, https, chrome-extension-resource

			//在某些浏览器中是允许这种操作的，比如Firefox浏览器，也就是说Filefox支持file协议下的AJAX请求。
			//Firefox浏览器中测试确实可以

			//解决办法：
			


		</script>
	</body>
</html>
